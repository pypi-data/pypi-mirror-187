{% extends 'layouts/app.html' %}


{% block content %}

    <section>
        <div class="row mb0">
            <div class="col s12 m6">
                <div class="card rounded">
                    <div class="card-content">
                        <span class="card-title center-align">{{ invoice.order.order_number }}</span>
                        <p class="center-align large">Subtotal: <b>{{ format_currency(invoice.subtotal ) }}</b></p>
                        <p class="center-align large">TAX: <b>{{ format_currency(invoice.tax) }}</b></p>
                        <p class="center-align large">Total: <b>{{ format_currency(invoice.total) }}</b></p>
                    </div>
                </div>
            </div>
            <div class="col s12 m6">
                <div class="row mb0">
                    {% for payment_method in payment_methods %}
                        <div class="col s12 m6">
                            <div class="card rounded">
                                <a href="{{ '#'+payment_method.name+'PaymentModal' if invoice.due > 0 }}"
                                   class="{{ 'modal-trigger' if invoice.due >0 else 'disabled' }}">
                                    <div class="card-content">
                                        <span class="card-title center-align black-text">{{ payment_method.name }}</span>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <div id="{{ payment_method.name }}PaymentModal"
                             class="modal keypad-modal">
                            <div class="modal-content p0">
                                <form class="number-keypad"
                                      action="{{ url_for('pos.payment', invoice_id=invoice.id) }}"
                                      method="POST"
                                      autocomplete="off">
                                    {{ form.hidden_tag() }}
                                    <input type="hidden" name="payment_method_id" value="{{ payment_method.id }}">
                                    <div class="number-keypad-display">
                                        {{ form.amount(autocomplete="new-password", id=payment_method.name + 'Display', step="any", min="0") }}
                                    </div>
                                    <div class="number-keypad-keys">
                                        <input type="button" value="7"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="8"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="9"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="4"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="5"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="6"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="1"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="2"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="3"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="X" class="modal-close red">
                                        <input type="button" value="0"
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <input type="button" value="."
                                               onclick="addNumber(this, '{{ payment_method.name + "Display" }}')">
                                        <button type="reset" class="yellow"><i
                                                class="material-icons">keyboard_backspace</i></button>
                                        <button type="submit" class="green"><i
                                                class="material-icons">keyboard_return</i></button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="row mb0">
            <div class="col {{ 's12 m6' if payments else 's12 m6 offset-m3' }}">
                <div class="card rounded">
                    <div class="card-content">
                        <p class="center-align large">Due: <b>{{ format_currency(invoice.due) }}</b></p>
                    </div>
                </div>
            </div>
            {% if payments %}
                <div class="col s12 m6">
                    <div class="card rounded">
                        <div class="card-content">
                            <table class="centered">
                                <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Method</th>
                                    <th>Amount</th>
                                    <th>Change</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for payment in payments %}
                                    <tr>
                                        <td>{{ payment.created_at.strftime('%Y-%m-%d') }}</td>
                                        <td>{{ payment.created_at.strftime('%H:%M') }}</td>
                                        <td>{{ payment.payment_method.name }}</td>
                                        <td>{{ format_currency(payment.amount) }}</td>
                                        <td>{{ format_currency(payment.change) }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>


        <div class="fixed-action-btn">
            <a href="{{ url_for('pos.index') }}" class="btn-floating btn-large blue accent-4">
                <i class="large material-icons">home</i>
            </a>
        </div>
    </section>


{% endblock %}
