(self.webpackChunkPaddleLabel_Frontend=self.webpackChunkPaddleLabel_Frontend||[]).push([[473],{16850:function(ke){ke.exports={conTent:"conTent___3tIpi","editable-cell":"editable-cell___29ByY","ant-table-content":"ant-table-content___371_P","ant-table-thead":"ant-table-thead___3SC5q","editable-cell-value-wrap":"editable-cell-value-wrap___1Ducl","editable-row":"editable-row___2d-EK"}},92086:function(ke){ke.exports={det:"det___1LaWK",mainStage:"mainStage___D5D-c",draw:"draw___15iZW",pblock:"pblock___B0IOl",progress:"progress___2-yD3",rightSideBar:"rightSideBar___34VZw",determinOutline:"determinOutline___2F44n",titles:"titles___1n-ow",tableConent:"tableConent___RT4LO","ant-table-wrapper":"ant-table-wrapper___2B8ou"}},44887:function(){},93181:function(ke,De,a){"use strict";a.d(De,{Z:function(){return p}});var xe=a(91220),b=a(11849),ne=a(67294),be=a(65031),fe=a(57406);function me(o,C,n){if(!(!o||!C))if(n==="/optical_character_recognition"){var X=C.join("|"),t=X+"||\u5F85\u8BC6\u522B|0|";return t}else return C.join(",")}function we(o,C,n){var X,t,c=o.annotation;if(!c||!c.result||c.result.length<2||!((X=c.label)!==null&&X!==void 0&&X.color))return ne.createElement(ne.Fragment,null);var E=c.result.split(",").map(Number);console.log("points",E.length);var Z=c.label.color,B=(0,fe.oo)(Z);if(!B)return ne.createElement(ne.Fragment,null);var k=((t=o.currentAnnotation)===null||t===void 0?void 0:t.frontendId)==c.frontendId,V=k?.5:.2,d=void 0,s=[];return E.forEach(function(m,x){if(x%2==0){d=m;return}s.push(ne.createElement(be.Cd,{onMouseDown:function(){o.currentTool=="editor"&&o.onSelect(c)},draggable:o.currentTool=="editor",onDragEnd:function(S){var y;S.cancelBubble=!0;var te=(y=o.stageRef)===null||y===void 0?void 0:y.current,j=te.findOne(".baseImage"),G=!1,le=S.target.x();le>j.width()/2&&(le=j.width()/2,G=!0),le<-j.width()/2&&(le=-j.width()/2,G=!0);var Ze=S.target.y();if(Ze>j.height()/2&&(Ze=j.height()/2,G=!0),Ze<-j.height()/2&&(Ze=-j.height()/2,G=!0),G&&S.target.setPosition({x:le,y:Ze}),E[x-1]=le,E[x]=Ze,o.pathName==="/optical_character_recognition"){var Be=n?"||".concat(n,"|0|"):"||\u5F85\u8BC6\u522B|0|",Pe=E.join("|")+Be,je=(0,b.Z)((0,b.Z)({},c),{},{result:Pe});o.onDragUP(je)}else{var ge=(0,b.Z)((0,b.Z)({},c),{},{result:E.join(",")});o.onDragUP(ge)}},onMouseOver:function(){var S,y;o.currentTool=="editor"&&(S=o.stageRef)!==null&&S!==void 0&&S.current&&(o.stageRef.current.container().style.cursor="cell"),(y=o.layerRef.current)===null||y===void 0||y.batchDraw()},onMouseOut:function(){var S;(S=o.stageRef)!==null&&S!==void 0&&S.current&&(o.stageRef.current.container().style.cursor="default")},x:d,y:m,radius:5/o.scale,fill:Z})),d=void 0}),ne.createElement(be.ZA,{key:c.frontendId,onClick:function(){(o.currentTool==="editor"||o.currentTool==="mover")&&o.onSelect(c)}},ne.createElement(be.x1,{onMouseOver:function(){o.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},stroke:Z,strokeWidth:2/o.scale,globalCompositeOperation:"source-over",lineCap:"round",points:E,tension:0,closed:C,fill:"rgba(".concat(B.r,", ").concat(B.g,", ").concat(B.b,", ").concat(V,")")}),s)}function H(o){var C=0;if(!o)return C;var n=(0,xe.Z)(o),X;try{for(n.s();!(X=n.n()).done;){var t=X.value;!t||!t.frontendId||t.frontendId>C&&(C=t.frontendId)}}catch(c){n.e(c)}finally{n.f()}return C}function p(o){var C=function(Z,B,k,V,d){var s,m,x=me((s=o.currentLabel)===null||s===void 0?void 0:s.color,[Z,B],V);if(!!x){var P={dataId:o.dataId,frontendId:(k==null?void 0:k.frontendId)!==void 0?k==null?void 0:k.frontendId:H(d)+1,label:o.currentLabel,labelId:(m=o.currentLabel)===null||m===void 0?void 0:m.labelId,result:x,type:""};V==="/optical_character_recognition"?(P.type="ocr_polygon",P.frontendId=H(d)+1):P.type="polygon",o.onAnnotationAdd(P)}},n=function(Z,B,k){var V;if(!(!o.currentAnnotation||!o.currentAnnotation.result||!((V=o.currentLabel)!==null&&V!==void 0&&V.color))){var d="";if(k==="/optical_character_recognition"){var s,m=(s=o.currentAnnotation.result)===null||s===void 0?void 0:s.split("||"),x=m[0]+"|".concat(Z,"|").concat(B);d=x+"||"+m[1]}else d=o.currentAnnotation.result+",".concat(Z,",").concat(B);var P=(0,b.Z)((0,b.Z)({},o.currentAnnotation),{},{result:d});o.onAnnotationModify(P)}},X=function(Z){if(o.currentTool=="polygon"){var B=Z.mouseX+Z.offsetX,k=Z.mouseY+Z.offsetY;!o.currentAnnotation&&Z.flags?C(B,k,o.selectFinly,Z.pathName,o.annotations):n(B,k,Z.pathName),o.onMouseDown&&o.onMouseDown()}},t=function(){},c=function(Z){o.currentTool=="polygon"&&Z.e.evt.button!==2&&o.onMouseUp&&o.onMouseUp()};return{onMouseDown:X,onMouseMove:t,onMouseUp:c,drawAnnotation:we}}},59519:function(ke,De,a){"use strict";a.d(De,{Z:function(){return X}});var xe=a(11849),b=a(67294),ne=a(65031),be=a(57406);function fe(t){if(!(!t||t.length<2))return t.join(",")}var me={x:0,y:0},we={x:0,y:0},H=!1;function p(t,c,E){console.log("drawGuidewires\u51FD\u6570\u6267\u884C\u4E86"),E.save(),E.strokeStyle="rgba(0,0,230,0.9)",E.lineWidth=.8,C(t,E),o(c,E),E.restore()}function o(t,c){c.beginPath(),c.moveTo(0,t+.5),c.lineTo(c.canvas.width,t+.5),c.stroke()}function C(t,c){c.beginPath(),c.moveTo(t+.5,0),c.lineTo(t+.5,c.canvas.height),c.stroke()}function n(t){var c,E=0;if(t.annotation.type=="ocr_rectangle"){var Z,B=(Z=t.annotation.result)===null||Z===void 0?void 0:Z.split("||")[0],k=B&&B.split("|").join(",");E=k==null?void 0:k.split(",").length}else{var V,d;E=t==null||(V=t.annotation)===null||V===void 0||(d=V.result)===null||d===void 0?void 0:d.split(",").length}if(E&&E<4)return b.createElement(b.Fragment,null);var s=t.annotation;if(!s||!s.result||!s.label||!s.label.color||!s.annotationId)return b.createElement(b.Fragment,null);var m=[];if(s.type=="ocr_rectangle"){var x,P=(x=s.result)===null||x===void 0?void 0:x.split("||")[0],S=P&&P.split("|").join(",");m=S.split(",")}else m=s.result.split(",");var y={xmin:parseInt(m[0]),ymin:parseInt(m[1]),xmax:m.length>=3?parseInt(m[2]):void 0,ymax:m.length>=4?parseInt(m[3]):void 0},te=s.label.color,j=(0,be.oo)(te);if(!j)return b.createElement(b.Fragment,null);var G=((c=t.currentAnnotation)===null||c===void 0?void 0:c.frontendId)==s.frontendId,le=G?.5:.2,Ze=y.xmax!=null&&y.ymax!=null?b.createElement(ne.UL,{onMouseOver:function(){t.currentTool=="editor"&&(document.body.style.cursor="pointer")},onMouseOut:function(){document.body.style.cursor="default"},onClick:function(){(t.currentTool==="editor"||t.currentTool==="mover")&&t.onSelect(s)},stroke:te,strokeWidth:2/t.scale,globalCompositeOperation:"source-over",lineCap:"round",x:y.xmin,y:y.ymin,width:y.xmax-y.xmin,height:y.ymax-y.ymin,closed:!0,fill:"rgba(".concat(j.r,", ").concat(j.g,", ").concat(j.b,", ").concat(le,")")}):b.createElement(b.Fragment,null);function Be(Pe){return!Pe&&(y.xmax==null||y.ymax==null)?b.createElement(b.Fragment,null):b.createElement(ne.Cd,{onMouseDown:function(){t.currentTool=="editor"&&t.onSelect(s)},onMouseOver:function(){var ge;t.currentTool=="editor"&&(ge=t.stageRef)!==null&&ge!==void 0&&ge.current&&(t.stageRef.current.container().style.cursor="cell")},onMouseOut:function(){var ge;(ge=t.stageRef)!==null&&ge!==void 0&&ge.current&&(t.stageRef.current.container().style.cursor="default")},x:Pe?y.xmin:y.xmax,y:Pe?y.ymin:y.ymax,radius:5/t.scale,fill:te})}return b.createElement(ne.ZA,{key:s.annotationId},Ze,Be(!0),Be(!1))}function X(t){var c=function(d,s,m){var x,P=fe([d,s]);if(!(!P||!t.dataId)){var S={dataId:t.dataId,type:"rectangle",frontendId:(0,be.pL)(t.annotations)+1,label:t.currentLabel,labelId:(x=t.currentLabel)===null||x===void 0?void 0:x.labelId};if(m==="/optical_character_recognition"){var y=P.split(",").join("|"),te=y+"||\u5F85\u8BC6\u522B|0|";S.result=te,S.type="ocr_rectangle"}else S.result=P;t.onAnnotationAdd(S)}},E=function(d,s,m){var x;if(!(!t.currentAnnotation||!t.currentAnnotation.result||!((x=t.currentLabel)!==null&&x!==void 0&&x.color))){var P="";if(m==="/optical_character_recognition"){var S,y=(S=t.currentAnnotation.result)===null||S===void 0?void 0:S.split("||"),te=y&&y[0].split("|");if(te.length<4)P=te.join("|")+"|".concat(d,"|").concat(s)+"||"+y[1];else{var j=te;j[2]=d+"",j[3]=s+"",P=j.join("|")+"||"+y[1]}}else if(t.currentAnnotation.result.length<4)P=t.currentAnnotation.result+",".concat(d,",").concat(s);else{var G=t.currentAnnotation.result.split(",");G[2]=d+"",G[3]=s+"",P=G.join(",")}var le=(0,xe.Z)((0,xe.Z)({},t.currentAnnotation),{},{result:P});t.onAnnotationModify(le),t.onMouseUp&&t.onMouseUp()}},Z=function(d){if(t.currentTool==="rectangle"||t.currentTool==="editor"){H=!0;var s=d.mouseX+d.offsetX,m=d.mouseY+d.offsetY;me.x=d.mouseX,me.y=d.mouseY,t.currentAnnotation||c(s,m,d.pathName),t.onMouseDown&&t.onMouseDown()}},B=function(d){t.currentTool!="rectangle"&&H!==!0||(we.x=d.mouseX,we.y=d.mouseY)},k=function(d){if(!(t.currentTool!="rectangle"&&t.currentTool!="editor"&&H)){H=!1;var s=d.mouseX+d.offsetX,m=d.mouseY+d.offsetY;E(s,m,d==null?void 0:d.pathName)}};return{onMouseDown:Z,onMouseMove:B,onMouseUp:k,drawAnnotation:n,drawGuidewires:p}}},11151:function(ke,De,a){"use strict";a.r(De),a.d(De,{default:function(){return Vn}});var xe=a(57663),b=a(71577),ne=a(20228),be=a(11382),fe=a(39428),me=a(3182),we=a(34792),H=a(48086),p=a(11849),o=a(91220),C=a(2824),n=a(67294),X=a(51505),t=a(48971),c=a(92086),E=a.n(c),Z=a(19466),B=a(93926),k=a(86582),V=a(38663),d=a(20136),s=a(44887),m=a(22122),x=a(28481),P=a(47918),S=a(94184),y=a.n(S),te=a(21770),j=a(15105),G=a(53124),le=a(55241),Ze=a(96159),Be=a(93887),Pe=a(86743),je=a(42051),ge=a(5767),mn=a(81643),gn=function(i){var R=i.prefixCls,A=i.okButtonProps,L=i.cancelButtonProps,w=i.title,N=i.cancelText,he=i.okText,J=i.okType,ye=i.icon,$=i.showCancel,ue=$===void 0?!0:$,Se=i.close,Ce=i.onConfirm,de=i.onCancel,Ee=n.useContext(G.E_),Ie=Ee.getPrefixCls;return n.createElement(je.Z,{componentName:"Popconfirm",defaultLocale:ge.Z.Popconfirm},function(h){return n.createElement("div",{className:"".concat(R,"-inner-content")},n.createElement("div",{className:"".concat(R,"-message")},ye&&n.createElement("span",{className:"".concat(R,"-message-icon")},ye),n.createElement("div",{className:"".concat(R,"-message-title")},(0,mn.Z)(w))),n.createElement("div",{className:"".concat(R,"-buttons")},ue&&n.createElement(b.Z,(0,m.Z)({onClick:de,size:"small"},L),N!=null?N:h.cancelText),n.createElement(Pe.Z,{buttonProps:(0,m.Z)((0,m.Z)({size:"small"},(0,Be.n)(J)),A),actionFn:Ce,close:Se,prefixCls:Ie("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},he!=null?he:h.okText)))})},_e=void 0,hn=function(v,i){var R={};for(var A in v)Object.prototype.hasOwnProperty.call(v,A)&&i.indexOf(A)<0&&(R[A]=v[A]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,A=Object.getOwnPropertySymbols(v);L<A.length;L++)i.indexOf(A[L])<0&&Object.prototype.propertyIsEnumerable.call(v,A[L])&&(R[A[L]]=v[A[L]]);return R},yn=n.forwardRef(function(v,i){var R=n.useContext(G.E_),A=R.getPrefixCls,L=(0,te.Z)(!1,{value:v.open!==void 0?v.open:v.visible,defaultValue:v.defaultOpen!==void 0?v.defaultOpen:v.defaultVisible}),w=(0,x.Z)(L,2),N=w[0],he=w[1],J=function(U,K){var Q,Ve;he(U,!0),(Q=v.onVisibleChange)===null||Q===void 0||Q.call(v,U,K),(Ve=v.onOpenChange)===null||Ve===void 0||Ve.call(v,U,K)},ye=function(U){J(!1,U)},$=function(U){var K;return(K=v.onConfirm)===null||K===void 0?void 0:K.call(_e,U)},ue=function(U){var K;J(!1,U),(K=v.onCancel)===null||K===void 0||K.call(_e,U)},Se=function(U){U.keyCode===j.Z.ESC&&N&&J(!1,U)},Ce=function(U){var K=v.disabled,Q=K===void 0?!1:K;Q||J(U)},de=v.prefixCls,Ee=v.placement,Ie=Ee===void 0?"top":Ee,h=v.trigger,f=h===void 0?"click":h,M=v.okType,T=M===void 0?"primary":M,ce=v.icon,F=ce===void 0?n.createElement(P.Z,null):ce,ae=v.children,Re=v.overlayClassName,ze=hn(v,["prefixCls","placement","trigger","okType","icon","children","overlayClassName"]),Ne=A("popover",de),He=A("popconfirm",de),Le=y()(He,Re);return n.createElement(le.Z,(0,m.Z)({},ze,{trigger:f,prefixCls:Ne,placement:Ie,onOpenChange:Ce,open:N,ref:i,overlayClassName:Le,_overlay:n.createElement(gn,(0,m.Z)({okType:T,icon:F},v,{prefixCls:Ne,close:ye,onConfirm:$,onCancel:ue}))}),(0,Ze.Tm)(ae,{onKeyDown:function(U){var K,Q;n.isValidElement(ae)&&((Q=ae==null?void 0:(K=ae.props).onKeyDown)===null||Q===void 0||Q.call(K,U)),Se(U)}}))}),Cn=yn,ut=a(47673),En=a(35920),In=a(32059),dt=a(9715),Je=a(96709),en=a(93224),nn=a(28991),bn=a(51213),Zn=a(47699),tn=function(i,R){return n.createElement(Zn.Z,(0,nn.Z)((0,nn.Z)({},i),{},{ref:R,icon:bn.Z}))};tn.displayName="CloseCircleOutlined";var Pn=n.forwardRef(tn),Sn=a(16850),An=a.n(Sn),On=["index"],Mn=["title","editable","children","dataIndex","record","handleSave"],an=n.createContext(null),Tn=function(i){var R=i.index,A=(0,en.Z)(i,On),L=Je.Z.useForm(),w=(0,C.Z)(L,1),N=w[0];return n.createElement(Je.Z,{form:N,component:!1},n.createElement(an.Provider,{value:N},n.createElement("tr",A)))},Dn=function(i){var R=i.title,A=i.editable,L=i.children,w=i.dataIndex,N=i.record,he=i.handleSave,J=(0,en.Z)(i,Mn),ye=(0,n.useState)(!1),$=(0,C.Z)(ye,2),ue=$[0],Se=$[1],Ce=(0,n.useRef)(null),de=(0,n.useContext)(an);(0,n.useEffect)(function(){ue&&Ce.current.focus()},[ue]);var Ee=function(){Se(!ue),de.setFieldsValue((0,In.Z)({},w,N[w]))},Ie=function(){var f=(0,me.Z)((0,fe.Z)().mark(function M(){var T;return(0,fe.Z)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.prev=0,F.next=3,de.validateFields();case 3:T=F.sent,Ee(),he((0,p.Z)((0,p.Z)({},N),T)),F.next=10;break;case 8:F.prev=8,F.t0=F.catch(0);case 10:case"end":return F.stop()}},M,null,[[0,8]])}));return function(){return f.apply(this,arguments)}}(),h=L;return A&&(h=ue?n.createElement(Je.Z.Item,{style:{margin:0},name:w,rules:[{required:!0,message:"".concat(R," is required.")}]},n.createElement(En.Z,{ref:Ce,onPressEnter:Ie,onBlur:Ie})):n.createElement("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:Ee},L)),n.createElement("td",J,h)},xn=function(i,R){var A=(0,n.useState)([]),L=(0,C.Z)(A,2),w=L[0],N=L[1],he=(0,n.useState)([]),J=(0,C.Z)(he,2),ye=J[0],$=J[1];(0,n.useEffect)(function(){if(!!i.annotations){var h=i.annotations.map(function(f){var M,T=f.result&&((M=f.result)===null||M===void 0?void 0:M.split("||")),ce=T&&T[1].split("|")[0];return(0,p.Z)({key:f==null?void 0:f.annotationId,address:ce},f)});N(h)}},[i.annotations]),(0,n.useEffect)(function(){var h;if(i.currentAnnotation&&(h=i.currentAnnotation)!==null&&h!==void 0&&h.annotationId){var f;$([(f=i.currentAnnotation)===null||f===void 0?void 0:f.annotationId])}},[i.currentAnnotation]);var ue=function(f){var M=w[w.findIndex(function(T){return T.key===f})];i.onAnnotationDelete(M)},Se=[{title:"",dataIndex:"address",render:function(f){return n.createElement("div",{style:{whiteSpace:"nowrap"}},f)},editable:!0},{title:"",dataIndex:"operation",render:function(f,M){return w.length>=1?n.createElement(Cn,{title:"Sure to delete?",onConfirm:function(){return ue(M.key)}},n.createElement(Pn,null)):null}}],Ce=function(f){var M,T=f==null||(M=f.result)===null||M===void 0?void 0:M.split("||")[0],ce=T+"||"+f.address+"|0|",F=(0,p.Z)((0,p.Z)({},f),{},{result:ce});delete F.address,delete F.key,i.onAnnotationModify(F),i.updataAnno(F);var ae=(0,k.Z)(w),Re=ae.findIndex(function(Ne){return f.key===Ne.key}),ze=ae[Re];ae.splice(Re,1,(0,p.Z)((0,p.Z)({},ze),f)),N(ae)},de={body:{row:Tn,cell:Dn}},Ee={onChange:function(f,M){var T=M[0];i.selectAnnotation(T)},getCheckboxProps:function(f){return{disabled:f.name==="Disabled User",name:f.name}}},Ie=Se.map(function(h){return h.editable?(0,p.Z)((0,p.Z)({},h),{},{onCell:function(M){return{record:M,editable:h.editable,dataIndex:h.dataIndex,title:h.title,handleSave:Ce}}}):h});return(0,n.useImperativeHandle)(R,function(){return{}}),n.createElement("div",{className:An().conTent,style:{overflow:"auto",height:"100%"}},n.createElement(B.Z,{rowSelection:(0,p.Z)((0,p.Z)({type:"radio"},Ee),{},{selectedRowKeys:ye}),pagination:!1,components:de,rowClassName:function(){return"editable-row"},bordered:!1,dataSource:w,columns:Ie}))},Rn=(0,n.forwardRef)(xn),Ln=a(8088),ie=a(61541),rn=a(44434),pn=a(57436),kn=a(84420),wn=a.n(kn),Un=a(28271),on=a(83721),Bn=a(59519),jn=a(93181),Nn=a(10137),Fn=a(36505),ln=a(27992),Kn=window.location.port=="8000"?"1234":window.location.port,Wn="http://".concat(window.location.hostname,":").concat(Kn,"/"),zn=function(){var i,R,A,L,w,N,he=(0,n.useState)(0),J=(0,C.Z)(he,2),ye=J[0],$=J[1],ue=(0,n.useState)(!0),Se=(0,C.Z)(ue,2),Ce=Se[0],de=Se[1],Ee=(0,n.useState)(!0),Ie=(0,C.Z)(Ee,2),h=Ie[0],f=Ie[1],M=(0,t.tT)("InteractorData"),T=M.interactorData,ce=M.setInteractorData,F=(0,n.useState)(50),ae=(0,C.Z)(F,2),Re=ae[0],ze=ae[1],Ne=(0,n.useState)(!1),He=(0,C.Z)(Ne,2),Le=He[0],Ae=He[1],U=(0,n.useState)(),K=(0,C.Z)(U,2),Q=K[0],Ve=K[1],Xn=(0,n.useState)(!1),un=(0,C.Z)(Xn,2),$n=un[0],Qe=un[1],Yn=(0,n.useState)(60),dn=(0,C.Z)(Yn,2),cn=dn[0],Hn=dn[1],pe=(0,on.RZ)(n.useState,Wn),Oe=(0,n.useRef)(null),W=(0,Fn.I)("pages.toolBar"),Te=(0,on.$L)(n.useState,n.useEffect,{effectTrigger:{postTaskChange:function(e,l){Ue.init({annos:l})}},label:{oneHot:!0,postSelect:function(){r.setCurr(void 0),$(0)},preUnsetCurr:qn},tool:{defaultTool:"mover"},task:{push:!1}}),re=Te.tool,Gn=Te.loading,Xe=Te.scale,r=Te.annotation,Ge=Te.task,z=Te.data,q=Te.project,Fe=Te.label,Ue=Te.annHistory,sn=(0,n.useRef)(z);sn.current=z;var Jn=wn()(z.imgSrc||"","anonymous"),Qn=(0,C.Z)(Jn,1),Ke=Qn[0];function qn(){r.setCurr(void 0),$(0),re.setCurr("mover")}var _=function(e){r.setCurr(e),e!=null&&e.frontendId?$(e.frontendId):$(0)},qe=function(e){var l=[];if(e.type==="ocr_polygon"){if(!e)return;var g=(0,o.Z)(r.all),O;try{for(g.s();!(O=g.n()).done;){var D=O.value;D.frontendId===e.frontendId?(l.push((0,p.Z)((0,p.Z)({},D),{},{result:e.result})),_(e)):l.push(D)}}catch(Ye){g.e(Ye)}finally{g.f()}}else{var I=(0,o.Z)(r.all),ee;try{for(I.s();!(ee=I.n()).done;){var oe=ee.value,Me="";if(oe.frontendId===e.frontendId){var se,ve;if((t.m8===null||t.m8===void 0||(se=t.m8.location)===null||se===void 0?void 0:se.pathname)==="/optical_character_recognition"){var We;Me=e==null||(We=e.result)===null||We===void 0?void 0:We.split("||")[0].split("|").join(",")}else Me=e==null?void 0:e.result;var $e=(ve=Me)===null||ve===void 0?void 0:ve.split(",").map(function(Ye){return Number(Ye)}),Y=($e[2]-$e[0])*($e[3]-$e[1]);Math.abs(Y)>10&&(oe.result=e==null?void 0:e.result,_(e),l.push(oe))}else l.push(oe)}}catch(Ye){I.e(Ye)}finally{I.f()}}r.setAll(l)},_n=function(e){var l=[],g=(0,o.Z)(r.all),O;try{for(g.s();!(O=g.n()).done;){var D=O.value;D.frontendId==e.frontendId?l.push(e):l.push(D)}}catch(I){g.e(I)}finally{g.f()}_(e),r.setAll(l),r.update(e),H.default.success(W("saveSuccess"))},et=function(){de(!0)},nt=function(){T.active||(Ue.record({annos:r.all,currAnno:r.curr}),de(!1))},tt=function(){var u=(0,me.Z)((0,fe.Z)().mark(function e(){var l,g,O,D,I,ee,oe,Me,se,ve,We;return(0,fe.Z)().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(Ue.record({annos:r.all,currAnno:r.curr}),r.curr){Y.next=3;break}return Y.abrupt("return");case 3:if(r.curr.result){Y.next=5;break}return Y.abrupt("return");case 5:if(r.curr.type!=="ocr_polygon"){Y.next=8;break}Y.next=24;break;case 8:if(O=r.all.length-1,D=r.all[O],I=D==null?void 0:D.result.split("||")[0],D&&(I==null?void 0:I.split("|").length)===2&&(oe=r==null||(ee=r.curr)===null||ee===void 0?void 0:ee.result,Me=oe.split("||")[0],se=I.split("|").concat(Me.split("|")),ve=se.join("|")+(D==null?void 0:D.result.split("||")[1]),r.curr.result=ve),We=r==null||(l=r.curr)===null||l===void 0?void 0:l.result.split("||")[0],!(We.length<3)){Y.next=16;break}return _(void 0),Y.abrupt("return");case 16:if((r==null||(g=r.curr)===null||g===void 0?void 0:g.annotationId)!=null){Y.next=21;break}return Y.next=19,r.create(r==null?void 0:r.curr);case 19:Y.next=22;break;case 21:r.update(r==null?void 0:r.curr);case 22:_(void 0),H.default.success(W("saveSuccess"));case 24:case"end":return Y.stop()}},e)}));return function(){return u.apply(this,arguments)}}(),vn={dataId:(i=z.curr)===null||i===void 0?void 0:i.dataId,currentLabel:Fe.all&&Fe.all[0],scale:Xe.curr,currentTool:re.curr,annotations:r.all,currentAnnotation:r.curr,onAnnotationAdd:function(e){_(e);var l=r.all.concat([e]);r.setAll(l)},onAnnotationModify:qe,onMouseUp:nt,onMouseDown:et,frontendIdOps:{frontendId:ye,setFrontendId:$},pathName:t.m8===null||t.m8===void 0||(R=t.m8.location)===null||R===void 0?void 0:R.pathname},at=function(e){if(!e||e.length==0)return 0;var l=0,g=(0,o.Z)(e),O;try{for(g.s();!(O=g.n()).done;){var D=O.value;D.frontendId>l&&(l=D.frontendId)}}catch(I){g.e(I)}finally{g.f()}return l},rt=function(e){if(!e)return"";var l=document.createElement("canvas");l.width=e.width,l.height=e.height;var g=l.getContext("2d");g==null||g.drawImage(e,0,0,e.width,e.height);var O=l.toDataURL("image/png");return O.replace(/^data:image\/(png|jpg);base64,/,"")},fn=function(e){var l=rt(e),g=Re||.5,O=z==null?void 0:z.curr,D=pe.predict("PaddleOCR",{format:"b64",img:l,piggyback:{dataId:O==null?void 0:O.dataId}});!D||D.then(function(I){if(I){var ee,oe,Me=(ee=sn.current.curr)===null||ee===void 0?void 0:ee.dataId;if(Me!==I.piggyback.dataId)return;var se=I.predictions.map(function(ve){if(ve.score>g)return ve});Ae(!1),z.updatePredicted((oe=z.all[0])===null||oe===void 0?void 0:oe.dataId,!0),ce({active:!0,mousePoints:T.mousePoints,predictData:se})}},function(I){alert("error",I),pe.setLoading(!1)})},ot={polygon:(0,jn.Z)(vn),rectangle:(0,Bn.Z)(vn)};(0,X.Z)(function(){if(z.all.length>0)if(z.all[0].predicted){var u=!1;u!==Le&&Ae(u)}else{var e=!0;e!==Le&&Ae(e)}},[z.all]),(0,n.useEffect)(function(){Ce||tt()},[Ce]),(0,X.Z)(function(){if(Le){var u;if(pe.loading){H.default.error(W("modelLoading"));return}var e=(u=q.curr)!==null&&u!==void 0&&u.otherSettings?q.curr.otherSettings:{};if(!(e!=null&&e.mlBackendUrl))return;pe.setMlBackendUrl(e.mlBackendUrl||""),pe.setLoading(!0);var l={lang:e.lang};pe.load(e.modelName,l).then(function(){pe.setLoading(!1),h&&f(!1)},function(){pe.setLoading(!1),h||f(!0)})}else{var g;Ve((g=q.curr)===null||g===void 0?void 0:g.otherSettings)}},[Le,(A=q.curr)===null||A===void 0?void 0:A.otherSettings]),(0,X.Z)(function(){var u=!h&&Ke&&Le;u&&fn(Ke)},[h,Le,Ke]),(0,X.Z)(function(){var u;T.predictData.length&&((u=q.curr)===null||u===void 0?void 0:u.projectId)!==void 0&&Fe.getAll(q.curr.projectId).then(function(e){var l,g=[],O=(l=r.all)!==null&&l!==void 0&&l.length?at(r.all)+1:1;T.predictData.map(function(I){if(I){var ee=I.result,oe=Q==null?void 0:Q.modelName,Me=e&&e[0];if(T.active){var se,ve=(0,Un.tx)(O,ee,(se=z.curr)===null||se===void 0?void 0:se.dataId,Me,oe);ve&&(g.push(ve),O++)}}});var D=!0;r.create(g,"",D),ce({active:!1,predictData:[],mousePoints:[]}),Qe(!1)})},[q==null||(L=q.curr)===null||L===void 0?void 0:L.projectId,T.predictData,Q,$n]);var lt=function(){var u=(0,me.Z)((0,fe.Z)().mark(function e(l){var g,O;return(0,fe.Z)().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return O=r.all.filter(function(ee){return ee.frontendId!=l.frontendId}),Ue.record({annos:O}),r.setAll(O),_(void 0),I.next=6,r.pushToBackend((g=z.curr)===null||g===void 0?void 0:g.dataId,O);case 6:case"end":return I.stop()}},e)}));return function(l){return u.apply(this,arguments)}}(),it=function(e){var l;r.setAll(e),r.pushToBackend((l=z.curr)===null||l===void 0?void 0:l.dataId,e)};return n.createElement(Ln.Z,{className:E().det},n.createElement(rn.Z,null,n.createElement(ie.Z,{imgSrc:"./pics/buttons/polygon.png",active:re.curr=="polygon",disabled:T.active,onClick:function(){var e;if(!Fe.curr&&(t.m8===null||t.m8===void 0||(e=t.m8.location)===null||e===void 0?void 0:e.pathname)!=="/optical_character_recognition"){H.default.error(W("chooseCategoryFirst"));return}re.setCurr("polygon"),_(void 0)}},W("polygon")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/rectangle.png",active:re.curr=="rectangle",onClick:function(){var e;if(!Fe.curr&&(t.m8===null||t.m8===void 0||(e=t.m8.location)===null||e===void 0?void 0:e.pathname)!=="/optical_character_recognition"){H.default.error(W("chooseCategoryFirst"));return}re.setCurr("rectangle"),_(void 0)}},W("rectangle")),n.createElement(ie.Z,{active:re.curr=="editor",imgSrc:"./pics/buttons/edit.png",onClick:function(){re.setCurr("editor")}},W("edit")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/zoom_in.png",onClick:function(){Xe.change(.1)}},W("zoomIn")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/zoom_out.png",onClick:function(){Xe.change(-.1)}},W("zoomOut")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/save.png",onClick:function(){var e;r.pushToBackend((e=z.curr)===null||e===void 0?void 0:e.dataId)}},W("save")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/move.png",active:re.curr=="mover",onClick:function(){re.setCurr("mover")}},W("move")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/prev.png",onClick:function(){Ue.backward().then(function(e){if(e){var l;r.setAll(e.annos),_(e.currAnno),r.pushToBackend((l=z.curr)===null||l===void 0?void 0:l.dataId,e.annos)}})}},W("unDo")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/next.png",onClick:function(){Ue.forward().then(function(e){if(e){var l;r.pushToBackend((l=z.curr)===null||l===void 0?void 0:l.dataId,e.annos),_(e.currAnno)}})}},W("reDo")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/clear_mark.png",onClick:function(){var e;r.clear(),Ue.record({annos:[]}),re.setCurr(void 0),(t.m8===null||t.m8===void 0||(e=t.m8.location)===null||e===void 0?void 0:e.pathname)!=="/optical_character_recognition"&&Fe.setCurr(void 0)}},W("clearMark"))),n.createElement("div",{id:"dr",className:"mainStage"},n.createElement(be.Z,{tip:"loading",spinning:!!Gn.curr},n.createElement("div",{className:"draw"},n.createElement(pn.Z,{ref:Oe,taskIndex:Ge.currIdx,scale:Xe.curr,scaleChange:Xe.setScale,annotations:r.all,currentTool:re.curr,currentAnnotation:r.curr,setCurrentAnnotation:_,onAnnotationModify:qe,annotationDelete:it,onAnnotationModifyComplete:function(){},frontendIdOps:{frontendId:ye,setFrontendId:$},imgSrc:z.imgSrc,transparency:cn,onAnnotationAdd:function(e){var l=r.all.concat([e]);r.setAll(l)},tool:re,drawTool:ot,threshold:0,onAnnotationModifyUP:_n})),n.createElement("div",{className:"pblock"},n.createElement(Nn.Z,{task:Ge,project:q})),n.createElement("div",{className:"prevTask","data-test-id":"prevTask",onClick:function(){if(!!Ge.prevTask()&&(ce({active:!1,predictData:[],mousePoints:[]}),_(void 0),Qe(!1),Oe!=null&&Oe.current)){var e;Oe==null||(e=Oe.current)===null||e===void 0||e.setDragEndPos({x:0,y:0})}}}),n.createElement("div",{className:"nextTask","data-test-id":"nextTask",onClick:function(){var e;!Ge.nextTask()||(ce({active:!1,predictData:[],mousePoints:[]}),_(void 0),Qe(!1),Oe==null||(e=Oe.current)===null||e===void 0||e.setDragEndPos({x:0,y:0}))}}))),n.createElement(rn.Z,{disLoc:"right"},n.createElement(ie.Z,{imgSrc:"./pics/buttons/data_division.png",onClick:function(){t.m8.push("/project_overview?projectId=".concat(q.curr.projectId))}},W("projectOverview")),n.createElement(ie.Z,{imgSrc:"./pics/buttons/intelligent_interaction.png",disabled:!Ke||!(q!=null&&(w=q.curr)!==null&&w!==void 0&&(N=w.otherSettings)!==null&&N!==void 0&&N.mlBackendUrl),onClick:function(){Ke&&fn(Ke)}},W("autoInference")),n.createElement(ln.Z,{disabled:T.active,imgSrc:"./pics/buttons/threshold.png",disLoc:"left",size:Re,maxSize:1,minSize:.1,step:.1,onChange:function(e){ze(e)}},W("autoInferenceThreshold")),n.createElement(ln.Z,{imgSrc:"./pics/buttons/alpha.png",disLoc:"left",size:cn,maxSize:100,minSize:0,disabled:T.active,onChange:function(e){Hn(e)}},W("transparency"))),n.createElement("div",{className:"rightSideBar",style:{padding:"10px"}},n.createElement("div",{className:"titles",style:{textAlign:"center",padding:"20px",background:"#1727C2",color:"white"}},"\u8BC6\u522B\u7ED3\u679C"),n.createElement("div",{style:{height:"500px",border:"3px solid"}},n.createElement(Rn,{onAnnotationDelete:lt,onAnnotationModify:qe,updataAnno:r.update,annotations:r.all,currentAnnotation:r.curr,selectAnnotation:r.setCurr})),n.createElement("div",{style:{display:"flex",justifyContent:"space-around",marginTop:"20px"}},n.createElement("div",{style:{width:"100%"}},n.createElement(b.Z,{type:"primary",block:!0},"\u786E\u5B9A")))))},Vn=zn},51505:function(ke,De,a){"use strict";a.d(De,{Z:function(){return be}});var xe=a(67294),b=function(me){return function(we,H){var p=(0,xe.useRef)(!1);me(function(){return function(){p.current=!1}},[]),me(function(){if(!p.current)p.current=!0;else return we()},H)}},ne=null,be=b(xe.useEffect)}}]);
