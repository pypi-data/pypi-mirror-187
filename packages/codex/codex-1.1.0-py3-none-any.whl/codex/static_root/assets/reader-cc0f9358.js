import{_ as m,o as u,d as k,w as l,j as g,t as f,H as Be,I as oe,a8 as Ie,L as se,K as U,bH as W,J as R,A as B,b as S,f as n,e as I,a as y,al as C,D as w,c as _,bK as xe,bL as De,k as c,i as v,ay as x,ba as ae,bM as Ve,bN as Le,bO as Ee,bP as Oe,r as N,bQ as ne,F as T,bR as re,bS as Ae,bT as Ne,bU as Fe,aU as E,aQ as Ge,bV as Me,C as Ue,h as O,an as q,ao as We,ap as qe,bI as Ke,bW as je,n as K,p as j,M as ie,bX as ze,S as le,bY as He,bt as Ye,bZ as Xe,b_ as Qe,b$ as z,a7 as Ze,bf as Je,b3 as et,c0 as tt,bv as ot,c1 as st,bw as at,c2 as nt,bx as rt,av as it,c3 as lt,c4 as ct,c5 as ut,c6 as dt,q as pt,s as gt,V as H,b9 as ce,B as Y,b8 as _t,c7 as ht,b4 as X,bo as Q,c8 as mt}from"./admin-92aa290d.js";import{_ as ue,g as ft,A as V,a as de,b as pe,j as $,P as ge,c as _e,k as kt}from"./metadata-dialog-334b0efe.js";const bt={name:"ReaderNavButton",components:{PaginationNavButton:ue},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{toRoute(){return{params:{...this.$route.params,page:this.value}}},title(){return"to page "+this.value},disabled(){return this.value===+this.$route.params.page||this.twoPages&&this.value%2&&this.value-1===+this.$route.params.page}}};function vt(e,t,o,i,a,s){const r=ue;return u(),k(r,{disabled:s.disabled,title:s.title,to:s.toRoute},{default:l(()=>[g(f(o.value),1)]),_:1},8,["disabled","title","to"])}const he=m(bt,[["render",vt]]),me={fitTo:"",twoPages:null};Object.freeze(me);const A=new Set(["",null,void 0]);Object.freeze(A);const Pt=()=>Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)>600?"HEIGHT":"WIDTH",h=Be("reader",{state:()=>({choices:{fitTo:oe.reader.fitTo,nullValues:A},readerSettings:{fitTo:Pt(),twoPages:!1},books:new Map,seriesCount:0,pk:void 0,routes:{prev:!1,next:!1,books:{prev:!1,next:!1}},bookChange:void 0}),getters:{activeBook(e){return e.books.get(e.pk)},activeSettings(e){const t=e.activeBook,o=t?t.settings:{};return this.getSettings(e.readerSettings,o)},activeTitle(e){const t=e.activeBook;return t?ft(t):""}},actions:{getSettings(e,t){t||(t={});const o={};for(const[i,a]of Object.entries(e)){const s=t[i],r=A.has(s)?a:s;o[i]=r}return o},getFitToClass(e){let t={};const o=e.fitTo;if(o){let i="fitTo";i+=o.charAt(0).toUpperCase()+o.slice(1).toLowerCase(),e.twoPages&&(i+="Two"),t[i]=!0}return t},_numericValues(e){if(!e)return e;const t={};for(const[o,i]of Object.entries(e))t[o]=+i;return t},_getRouteParams(e,t){let o=this.activeSettings.twoPages?2:1;t==="prev"&&(o=o*-1);const i=+e+o;let a=!1;return i>=0&&i<=this.activeBook.maxPage&&(a={pk:this.pk,page:i}),a},_updateSettings(e,t){if(e===0)this.readerSettings={...this.readerSettings,...t};else{const o=this.books.get(e);o.settings={...o.settings,...t}}},_setRoutes(e){this.$patch(t=>{t.routes.prev=this._getRouteParams(e,"prev"),t.routes.next=this._getRouteParams(e,"next")})},_getBookRoutes(e,t,o){let i=!1;if(t){const s=e.books.get(t),d=this.getSettings(this.readerSettings,s.settings).twoPages?-1:0;i={pk:t,page:s.maxPage+d}}let a=!1;return o&&(a={pk:o,page:0}),{prev:i,next:a}},async loadReaderSettings(){return V.getReaderSettings().then(e=>{const t=e.data;return this._updateSettings(0,t),!0}).catch(console.error)},async loadBooks(e){const t=this._numericValues(e);await V.getReaderInfo(t.pk).then(o=>{const i=o.data;let a=!1,s=!1;return this.$patch(r=>{const d=new Map;for(const[p,b]of i.books.entries())b.pk!==t.pk&&(p===0?a=b.pk:s=b.pk),d.set(b.pk,Ie(b));r.books=d,r.seriesCount=i.seriesCount,r.pk=t.pk,r.routes.books=this._getBookRoutes(r,a,s)}),this._setRoutes(t.page),!0}).catch(o=>{console.debug(o);const i=se().page,a=i&&i.routes?i.routes.last:{name:"home"};return U.push(a)})},async _setBookmarkPage(e){const t={group:"c",pk:this.pk};e=Math.max(Math.min(this.activeBook.maxPage,e),0);const o={page:e};await W.setGroupBookmarks(t,o).then(()=>R().setTimestamp())},async setRoutesAndBookmarkPage(e){this._setRoutes(e),await this._setBookmarkPage(e).then(()=>(this.bookChange=void 0,!0))},async setSettingsLocal(e,t){const o=this._numericValues(e);this._updateSettings(o.pk,t),await W.setGroupBookmarks({group:"c",pk:o.pk},this.activeBook.settings)},async clearSettingsLocal(e){const t=this._numericValues(e);await this.setSettingsLocal(t,me)},async setSettingsGlobal(e,t){const o=this._numericValues(e);this._updateSettings(0,t),await V.setReaderSettings(this.readerSettings),await this.clearSettingsLocal(o)},setBookChangeFlag(e){this.bookChange=this.routes.books[e]?e:void 0},_validateRoute(e){const t=this.books.get(e.pk);if(!t)return{};const o=t.maxPage??0;return e.page>o?(e.page=o,console.warn("Tried to navigate past the end of the book.")):e.page<0?(e.page=0,console.warn("Tried to navigate before the beginning of the book.")):this.getSettings(this.readerSettings,t.settings).twoPages&&e.page%2!==0&&(e.page=e.page-1,console.warn("Requested odd page in two pages mode. Flip back one")),e},_routeTo(e){e=this._validateRoute(e);const t={name:"reader",params:e};return U.push(t).catch(console.debug)},routeToDirection(e){if(this.routes[e]){const t=this.routes[e];this._routeTo(t)}else this.routes.books[e]?this.bookChange===e?this._routeTo(this.routes.books[e]):this.setBookChangeFlag(e):console.debug("No route to direction",e)},routeToPage(e){const t={pk:this.pk,page:e};this._routeTo(t)}}}),wt={name:"ReaderNavToolbar",components:{PaginationSlider:de,ReaderNavButton:he,PaginationToolbar:pe},computed:{...B(h,["activeSettings","activeBook"]),key(){return`${this.$route.params.pk} - ${this.twoPages}`},maxPage(){return this.activeBook?this.activeBook.maxPage:0},twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.$route.params.page>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""}},methods:{...S(h,["routeToPage"])}};function St(e,t,o,i,a,s){const r=he,d=de,p=pe;return s.maxPage?(u(),k(p,{key:0},{default:l(()=>[n(r,{value:0}),(u(),k(d,{key:s.key,"model-value":+e.$route.params.page,min:0,max:s.maxPage,step:s.step,"track-color":s.trackColor,"onUpdate:modelValue":t[0]||(t[0]=b=>e.routeToPage(b))},null,8,["model-value","max","step","track-color"])),n(r,{value:s.maxPage,"two-pages":s.twoPages},null,8,["value","two-pages"])]),_:1})):I("",!0)}const fe=m(wt,[["render",St]]),yt={rel:"prefetch",as:"image"},ke=function(e){const t=[];for(const o of e)o&&t.push({...yt,href:o});return{link:t}};const Tt={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return ke([this.prefetchSrc1,this.prefetchSrc2])},computed:{...y(h,{params(e){return e.routes[this.direction]},prefetchSrc2(e){const t=e.books.get(this.params.pk);if(!t)return!1;const o=t.settings||{};if(!this.getSettings(e.readerSettings,o).twoPages)return!1;const a={...this.params,page:this.params.page+1};return a.page>t.maxPage?!1:$(a)}}),prefetchSrc1(){return this.params?$(this.params):!1},route(){return this.params?{params:this.params}:{}},label(){return`${this.direction==="prev"?"Previous":"Next"} Page`}},methods:{...S(h,["getSettings"])}};function Ct(e,t,o,i,a,s){const r=w("router-link");return u(),k(r,{class:C(["pageChangeColumn",{[o.direction]:!0}]),to:s.route,"aria-label":s.label,onClick:t[0]||(t[0]=d=>d.stopImmediatePropagation())},null,8,["to","aria-label","class"])}const be=m(Tt,[["render",Ct],["__scopeId","data-v-aa4efc86"]]);const $t={name:"LoadingPage",components:{Placeholder:ge},props:{twoPages:{type:Boolean,required:!0}}};function Rt(e,t,o,i,a,s){const r=w("Placeholder");return u(),_("div",{class:C(["pageLoading",{twoPages:o.twoPages}])},[n(r,{class:"pagePlaceholder"})],2)}const Bt=m($t,[["render",Rt],["__scopeId","data-v-2bc79db9"]]);const Z="unauthorized",It={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===Z?"Protected page":"Failed to load page"},icon(){return this.type===Z?xe:De}}},xt={class:"pageErrorContainer"},Dt={class:"pageErrorText"};function Vt(e,t,o,i,a,s){return u(),_("div",{class:C(["pageError",{twoPages:o.twoPages}])},[c("div",xt,[c("div",Dt,f(s.text),1),n(v,{class:"pageErrorIcon"},{default:l(()=>[g(f(s.icon),1)]),_:1})])],2)}const Lt=m(It,[["render",Vt],["__scopeId","data-v-afc58246"]]);const Et={name:"ImgPage",props:{pk:{type:Number,required:!0},src:{type:String,required:!0},settings:{type:Object,required:!0},fitToClass:{type:Object,required:!0}},emits:["load","error"]},Ot=["src"];function At(e,t,o,i,a,s){return u(),_("img",x({class:o.fitToClass,src:o.src},e.$attrs),null,16,Ot)}const Nt=m(Et,[["render",At],["__scopeId","data-v-390f08d7"]]);const Ft=ae(Ve(()=>Ee(()=>import("./page-pdf-f5440425.js"),["assets/page-pdf-f5440425.js","assets/admin-92aa290d.js","assets/admin-03ccea7a.css","assets/metadata-dialog-334b0efe.js","assets/metadata-dialog-5292749d.css","assets/page-pdf-da2d2f8b.css"]))),Gt=333,Mt={name:"BookPage",components:{Placeholder:ge,ErrorPage:Lt,LoadingPage:Bt},props:{book:{type:Object,required:!0},page:{type:Number,required:!0},settings:{type:Object,required:!0},fitToClass:{type:Object,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{src(){const e={pk:this.book.pk,page:this.page};return $(e)},component(){return this.book.fileFormat==="pdf"?Ft:Nt}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},Gt)},methods:{onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},Ut={class:"page"};function Wt(e,t,o,i,a,s){const r=w("ErrorPage"),d=w("LoadingPage");return u(),_("div",Ut,[a.error?(u(),k(r,{key:0,"two-pages":o.settings.twoPages,type:a.error},null,8,["two-pages","type"])):a.showProgress&&!a.loaded?(u(),k(d,{key:1,"two-pages":o.settings.twoPages},null,8,["two-pages"])):(u(),k(Le(s.component),{key:2,pk:o.book.pk,src:s.src,settings:o.settings,"fit-to-class":o.fitToClass,onError:s.onError,onLoad:s.onLoad,onUnauthorized:s.onUnauthorized},null,40,["pk","src","settings","fit-to-class","onError","onLoad","onUnauthorized"]))])}const qt=m(Mt,[["render",Wt],["__scopeId","data-v-887e7676"]]),Kt={name:"PagesWindow",components:{BookPage:qt,PageChangeLink:be},props:{book:{type:Object,required:!0}},emits:["click"],data(){return{activePage:void 0}},computed:{...y(h,{bookRoutes:e=>e.routes.books,settings(e){const t=e.books.get(this.book.pk),o=t?t.settings:{};return e.getSettings(e.readerSettings,o)},prevBookPk:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev.pk},twoPages:e=>e.activeSettings.twoPages}),fitToClass(){return this.getFitToClass(this.settings)},pages(){var o;const e=((o=this.book)==null?void 0:o.maxPage)+1,t=this.settings.twoPages?2:1;return Oe.range(0,e,t)},secondPage(){return this.settings.twoPages&&+this.activePage+1<=this.book.maxPage}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePageForRoute(+e.params.page)},twoPages(){this.setActivePageForRoute(+this.$route.params.page)}},created(){let e;this.book.pk===+this.$route.params.pk?e=+this.$route.params.page:this.book.pk===this.prevBookPk?e=this.book.maxPage:e=0,this.activePage=e},methods:{...S(h,["routeToPage","setRoutesAndBookmarkPage","setRoutes","getSettings","getFitToClass"]),setActivePageForRoute(e){if(e<0)return console.warn("Page out of bounds. Redirecting to 0."),this.routeToPage(0);if(e>this.book.maxPage)return console.warn(`Page out of bounds. Redirecting to ${this.book.maxPage}.`),this.routeToPage(this.book.maxPage);if(this.settings.twoPages&&e%2!==0)return console.debug(`Requested odd page ${e} in two pages mode. Flip back one`),this.routeToPage(e-1);this.activePage=e,this.setRoutesAndBookmarkPage(+this.$route.params.page),window.scrollTo(0,0)}}};function jt(e,t,o,i,a,s){const r=be,d=w("BookPage");return u(),k(re,{"show-arrows":"","model-value":a.activePage},{prev:l(()=>[n(r,{direction:"prev"})]),next:l(()=>[n(r,{direction:"next"})]),default:l(()=>[(u(!0),_(T,null,N(s.pages,p=>(u(),k(ne,{key:`c/${o.book.pk}/${p}`,class:"windowItem",disabled:"",eager:p>=a.activePage-1&&p<=a.activePage+2,"model-value":p,transition:!0},{default:l(()=>[n(d,{book:o.book,settings:e.settings,"fit-to-class":s.fitToClass,page:p},null,8,["book","settings","fit-to-class","page"]),s.secondPage?(u(),k(d,{key:0,book:o.book,settings:e.settings,"fit-to-class":s.fitToClass,page:p+1},null,8,["book","settings","fit-to-class","page"])):I("",!0)]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value"])}const ve=m(Kt,[["render",jt]]);const zt={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){return ke([this.prefetchSrc1,this.prefetchSrc2])},computed:{...y(h,{show(e){if(this.direction==="prev")return+this.$route.params.page==0;const t=e.activeBook?e.activeBook.maxPage:0,o=e.activeSettings.twoPages?1:0,i=t+o;return+this.$route.params.page>=i},prefetchSrc2(e){const t=e.books.get(this.params.pk),o=t?t.settings||{}:{},i=this.getSettings(e.readerSettings,o);if(!this.isDrawerOpen||!this.params||!i.twoPages)return!1;const a={pk:this.params.pk,page:this.params.page+1};return $(a)},isDrawerOpen(e){return e.bookChange===this.direction},params(e){return e.routes.books[this.direction]},icon(){return this.direction==="next"?Ae:Ne}}),prefetchSrc1(){return!this.isDrawerOpen||!this.params?!1:$(this.params)},route(){return this.params?{params:this.params}:{}},label(){return`${this.direction==="prev"?"Previous":"Next"} Book`}},methods:{...S(h,["getSettings","setBookChangeFlag"])}};function Ht(e,t,o,i,a,s){const r=w("router-link");return e.show?(u(),_("div",{key:0,class:C(["bookChangeColumn",{[o.direction]:!0}]),onClick:t[1]||(t[1]=E(d=>e.setBookChangeFlag(o.direction),["stop"]))},[n(Fe,{class:C(["bookChangeDrawer",{[o.direction]:!0}]),fixed:"",location:o.direction==="prev"?"left":"right","model-value":e.isDrawerOpen,temporarary:""},{default:l(()=>[n(r,{class:"navLink",to:s.route,"aria-label":s.label,title:s.label,onClick:t[0]||(t[0]=d=>d.stopImmediatePropagation())},{default:l(()=>[n(v,{class:"bookChangeIcon"},{default:l(()=>[g(f(e.icon),1)]),_:1})]),_:1},8,["to","aria-label","title"])]),_:1},8,["class","location","model-value"])],2)):I("",!0)}const Pe=m(zt,[["render",Ht],["__scopeId","data-v-25de317c"]]);const Yt={name:"BooksWindow",components:{BookChangeDrawer:Pe},emits:["click"],computed:{...y(h,{books:e=>e.books,bookChange:e=>e.bookChange,activeBookPk:e=>e.pk,bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag()},created(){this.loadBooks(this.$route.params)},methods:{...S(h,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function Xt(e,t,o,i,a,s){const r=Pe,d=ve;return u(),k(re,{id:"booksWindow",direction:"vertical","model-value":e.activeBookPk,"show-arrows":"",onClick:s.click},{prev:l(()=>[n(r,{direction:"prev"})]),next:l(()=>[n(r,{direction:"next"})]),default:l(()=>[(u(!0),_(T,null,N(e.books,([p,b])=>(u(),k(ne,{key:`c/${p}`,class:"windowItem",disabled:"",eager:s.eager(p),value:p,transition:!0},{default:l(()=>[n(d,{book:b,onClick:s.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","onClick"])}const Qt=m(Yt,[["render",Xt],["__scopeId","data-v-58a93e1c"]]);const J="prev",ee="next",Zt={name:"ReaderTitleToolbar",components:{MetadataDialog:_e,SettingsDrawerButton:Ge},data(){return{mdiClose:Me}},head(){const e=this.$route.params.page;return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${e}`}]}},computed:{...B(h,["activeTitle","activeBook"]),...y(h,{seriesPosition:function(e){return this.activeBook&&e.seriesCount>1?`${this.activeBook.seriesIndex}/${e.seriesCount}`:""}}),...y(se,{lastRoute:e=>e.page.routes.last}),...Ue(R,["isSettingsDrawerOpen"]),closeBookRoute:function(){const e={name:"browser",params:this.lastRoute};return e.params?e.hash=`#card-${this.$route.params.pk}`:e.params=window.CODEX.LAST_ROUTE||oe.browser.route,e}},mounted(){document.addEventListener("keyup",this._keyListener)},unmounted:function(){document.removeEventListener("keyup",this._keyListener)},methods:{...S(h,["routeToDirection"]),openMetadata:function(){this.$refs.metadataDialog.dialog=!0},_keyListener:function(e){switch(e.stopPropagation(),e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(ee):e.shiftKey&&window.scrollY===0&&this.routeToDirection(J);break;case"j":case"ArrowRight":this.routeToDirection(ee);break;case"k":case"ArrowLeft":this.routeToDirection(J);break;case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.openMetadata();break}}}},Jt={key:0},eo={key:0,id:"seriesPosition",title:"Series Position"};function to(e,t,o,i,a,s){const r=_e,d=w("SettingsDrawerButton");return u(),k(qe,{id:"readerTopToolbar",class:"codexToolbar",density:"compact"},{default:l(()=>[n(q,null,{default:l(()=>[n(O,{id:"closeBook",ref:"closeBook",to:s.closeBookRoute,size:"large"},{default:l(()=>[e.$vuetify.display.smAndDown?(u(),k(v,{key:1,title:"Close Book"},{default:l(()=>[g(f(a.mdiClose),1)]),_:1})):(u(),_("span",Jt,"close book"))]),_:1},8,["to"])]),_:1}),n(We,{id:"toolbarTitle",class:"codexToolbarTitle"},{default:l(()=>[g(f(e.activeTitle),1)]),_:1}),e.seriesPosition?(u(),_("span",eo,f(e.seriesPosition),1)):I("",!0),n(q,null,{default:l(()=>[n(O,{id:"tagButton",onClick:E(s.openMetadata,["stop"])},{default:l(()=>[n(r,{ref:"metadataDialog",group:"c",pk:Number(e.$route.params.pk)},null,8,["pk"])]),_:1},8,["onClick"]),n(d,{id:"settingsButton",onClick:t[0]||(t[0]=E(p=>e.isSettingsDrawerOpen=!0,["stop"]))})]),_:1})]),_:1})}const we=m(Zt,[["render",to],["__scopeId","data-v-84d2e0e2"]]),oo={name:"DownloadPanel",data(){return{mdiDownload:Ke,mdiFileImage:je}},computed:{...B(h,["activeTitle"]),pageSrc:function(){return $(this.$route.params)},downloadURL:function(){return kt(this.$route.params.pk)},fileName:function(){return this.activeTitle+".cbz"},pageName:function(){const e=this.$route.params.page;return`${this.activeTitle} - page ${e}.jpg`}},methods:{...S(R,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.fileName)}}};function so(e,t,o,i,a,s){return u(),_(T,null,[n(j,{onClick:s.downloadPage},{default:l(()=>[n(K,null,{default:l(()=>[n(v,null,{default:l(()=>[g(f(a.mdiFileImage),1)]),_:1}),g(" Download Page "+f(e.$route.params.page),1)]),_:1})]),_:1},8,["onClick"]),n(j,{onClick:s.downloadBook},{default:l(()=>[n(K,null,{default:l(()=>[n(v,null,{default:l(()=>[g(f(a.mdiDownload),1)]),_:1}),g(" Download Book ")]),_:1})]),_:1},8,["onClick"])],64)}const Se=m(oo,[["render",so]]);const L=ie({name:"VRadio",props:{...ze({falseIcon:"$radioOff",trueIcon:"$radioOn"})},setup(e,t){let{slots:o}=t;return le(()=>n(He,x(e,{class:"v-radio",type:"radio"}),o)),{}}});const te=ie({name:"VRadioGroup",inheritAttrs:!1,props:{height:{type:[Number,String],default:"auto"},...Ye(),...Xe(Qe(),["multiple"]),trueIcon:{type:z,default:"$radioOn"},falseIcon:{type:z,default:"$radioOff"},type:{type:String,default:"radio"}},emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:o,slots:i}=t;const a=Ze(),s=Je(()=>e.id||`radio-group-${a}`),r=et(e,"modelValue");return le(()=>{const[d,p]=tt(o),[b,F]=ot(e),[Te,Do]=st({...e,multiple:!1}),G=i.label?i.label({label:e.label,props:{for:s.value}}):e.label;return n(rt,x({class:"v-radio-group"},d,b,{modelValue:r.value,"onUpdate:modelValue":D=>r.value=D,id:s.value}),{...i,default:D=>{let{id:M,isDisabled:Ce,isReadonly:$e}=D;return n(T,null,[G&&n(at,{for:M.value},{default:()=>[G]}),n(nt,x(Te,{id:M.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:Ce.value,readonly:$e.value},p,{modelValue:r.value,"onUpdate:modelValue":Re=>r.value=Re}),i)])}})}),{}}}),ao=["fitTo","twoPages"],no={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1}},computed:{...y(h,{fitToChoices(e){const t=[];for(const o of e.choices.fitTo)o.value&&t.push(o);return t},selectedSettings:function(e){return this.isGlobalScope||!e.activeBook?e.readerSettings:e.activeBook.settings},isClearSettingsButtonDisabled:function(e){if(this.isGlobalScope||!e.activeBook)return!0;for(const t of ao){const o=e.activeBook.settings[t];if(!e.choices.nullValues.has(o))return!1}return!0}})},mounted(){document.addEventListener("keyup",this._keyListener)},unmounted:function(){document.removeEventListener("keyup",this._keyListener)},methods:{...S(h,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal"]),settingsDialogChanged:function(e){this.isGlobalScope?this.setSettingsGlobal(this.$route.params,e):this.setSettingsLocal(this.$route.params,e)},_keyListener:function(e){e.stopPropagation();let t;switch(e.key){case"w":t={fitTo:"WIDTH"};break;case"h":t={fitTo:"HEIGHT"};break;case"s":t={fitTo:"SCREEN"};break;case"o":t={fitTo:"ORIG"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break}t&&this.setSettingsLocal(this.$route.params,t)}}},ro={id:"readerSettings"};function io(e,t,o,i,a,s){return u(),_("div",ro,[n(te,{modelValue:a.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=r=>a.isGlobalScope=r),density:"compact",label:"Scope"},{default:l(()=>[n(L,{label:"Only this comic",value:!1}),n(L,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),n(te,{class:"displayRadioGroup",density:"compact",label:"Display","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=r=>s.settingsDialogChanged({fitTo:r}))},{default:l(()=>[(u(!0),_(T,null,N(e.fitToChoices,r=>(u(),k(L,{key:r.value,label:r.title,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(it,{class:"displayTwoPages",density:"compact",label:"Two pages","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=r=>s.settingsDialogChanged({twoPages:r}))},null,8,["model-value","indeterminate"]),n(O,{id:"clearSettingsButton",class:C({invisible:a.isGlobalScope}),disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:t[3]||(t[3]=r=>e.clearSettingsLocal(e.$route.params))},{default:l(()=>[g(" Clear Comic Settings ")]),_:1},8,["class","disabled"])])}const ye=m(no,[["render",io],["__scopeId","data-v-eba773e3"]]);const lo={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:lt,mdiMenuRight:ct,mdiKeyboardSpace:ut,mdiAppleKeyboardShift:dt}},computed:{...B(R,["isMobile"])}},P=e=>(pt("data-v-ac362d8d"),e=e(),gt(),e),co={key:0,id:"readerKeyboardShortcutsDialog"},uo=P(()=>c("h3",null,"Keyboard Shortcuts",-1)),po={id:"readerKeyboardShortcutsTable",class:"highlight-table"},go=P(()=>c("td",null,"Previous page",-1)),_o=P(()=>c("td",null,"Next page",-1)),ho=P(()=>c("tr",null,[c("td",null,"h"),c("td",null,"Fit page to screen height")],-1)),mo=P(()=>c("tr",null,[c("td",null,"w"),c("td",null,"Fit page to screen width")],-1)),fo=P(()=>c("tr",null,[c("td",null,"s"),c("td",null,"Fit page to screen")],-1)),ko=P(()=>c("tr",null,[c("td",null,"o"),c("td",null,"Show page at original size")],-1)),bo=P(()=>c("tr",null,[c("td",null,"2"),c("td",null,"Toggle two page view")],-1)),vo=P(()=>c("tr",null,[c("td",null,"m"),c("td",null,"Show comic's metadata")],-1)),Po=P(()=>c("tr",null,[c("td",null,"esc"),c("td",null,"Close book")],-1));function wo(e,t,o,i,a,s){return e.isMobile?I("",!0):(u(),_("div",co,[uo,c("table",po,[c("tbody",null,[c("tr",null,[c("td",null,[n(v,{class:"keyIcon",density:"compact"},{default:l(()=>[g(f(a.mdiMenuLeft),1)]),_:1}),g(", j, "),c("div",null,[n(v,{class:"keyIcon",density:"compact"},{default:l(()=>[g(f(a.mdiAppleKeyboardShift),1)]),_:1}),n(v,{class:"keyIcon",density:"compact"},{default:l(()=>[g(f(a.mdiKeyboardSpace),1)]),_:1})])]),go]),c("tr",null,[c("td",null,[n(v,{class:"keyIcon",density:"compact"},{default:l(()=>[g(f(a.mdiMenuRight),1)]),_:1}),g(", k, "),n(v,{class:"keyIcon",density:"compact"},{default:l(()=>[g(f(a.mdiKeyboardSpace),1)]),_:1})]),_o]),ho,mo,fo,ko,bo,vo,Po])])]))}const So=m(lo,[["render",wo],["__scopeId","data-v-ac362d8d"]]),yo={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:Se,ReaderKeyboardShortcutsPanel:So,ReaderSettingsPanel:ye}};function To(e,t,o,i,a,s){const r=ye,d=w("ReaderKeyboardShortcutsPanel"),p=Se;return u(),_(T,null,[n(r),n(H),n(d),n(H),n(p)],64)}const Co=m(yo,[["render",To]]);const $o={name:"MainReader",components:{BooksWindow:ve,ReaderNavToolbar:fe,ReaderTitleToolbar:we,SettingsDrawer:ce},data(){return{showToolbars:!1,ReaderSettingsSuperPanel:ae(Co)}},computed:{...B(Y,["isCodexViewable"]),...y(Y,{user:e=>e.user})},watch:{user:function(){this.loadReaderSettings()},isCodexViewable:function(){this.loadReaderSettings()}},created(){R().isSettingsDrawerOpen=!1,this.loadReaderSettings()},methods:{...S(h,["loadReaderSettings"]),toggleToolbars:function(){this.showToolbars=!this.showToolbars}}},Ro={key:0,id:"readerContainer"},Bo={key:1,id:"announcement"};function Io(e,t,o,i,a,s){const r=we,d=Qt,p=fe,b=w("router-link"),F=ce;return u(),_(T,null,[n(_t,{id:"readerWrapper"},{default:l(()=>[e.isCodexViewable?(u(),_("div",Ro,[n(ht,null,{default:l(()=>[X(n(r,null,null,512),[[Q,a.showToolbars]])]),_:1}),n(d,{onClick:s.toggleToolbars},null,8,["onClick"]),n(mt,null,{default:l(()=>[X(n(p,null,null,512),[[Q,a.showToolbars]])]),_:1})])):(u(),_("div",Bo,[c("h1",null,[n(b,{to:{name:"home"}},{default:l(()=>[g(" Log in ")]),_:1}),g(" to read comics ")])]))]),_:1}),n(F,{title:"Reader Settings",panel:a.ReaderSettingsSuperPanel,temporary:""},null,8,["panel"])],64)}const xo=m($o,[["render",Io],["__scopeId","data-v-5bf47d4d"]]),Eo=Object.freeze(Object.defineProperty({__proto__:null,default:xo},Symbol.toStringTag,{value:"Module"}));export{Eo as r,h as u};
